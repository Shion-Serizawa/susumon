# Learning Log / Meta Note アプリ 機能仕様（v0.1）

## 1. 概要
本アプリケーションは、学習の継続と振り返りを目的とした個人用ログ管理アプリである。

- **ラーニングログ**：学習の事実（いつ・何をやったか）を日次で記録・可視化する
- **メタノート**：学習中・学習後に生じた思考（気づき / 疑問 / 感情）を記録・整理する

本仕様は、機能要件のみを対象とし、技術スタックは別途定義する。

---

## 2. ドメインモデル

### 2.1 Theme（学習テーマ）

| 項目 | 型 | 必須 | 説明 |
|---|---|---|---|
| id | string | ✓ | テーマID |
| name | string | ✓ | テーマ名 |
| shortName | string | | 省略名（未設定時はUI側で `...` 表示） |
| goal | string | ✓ | 学習目標（文章） |
| isCompleted | boolean | ✓ | 目標達成フラグ |
| createdAt | datetime | ✓ | 作成日時 |
| updatedAt | datetime | ✓ | 更新日時 |

- テーマ構造はフラット（階層なし）
- `isCompleted = true` のテーマは、ラーニングログ入力UIでは非表示
- メタノート入力UIでは、トグルにより達成済みテーマも選択可能

---

### 2.2 LearningLogEntry（日次ラーニングログ）

| 項目 | 型 | 必須 | 説明 |
|---|---|---|---|
| id | string | ✓ | ログエントリID（UUIDv7） |
| themeId | string | ✓ | 紐づくテーマID |
| date | date | ✓ | 対象日付（YYYY-MM-DD） |
| summary | string | ✓ | その日にやったことの要約（1〜2行） |
| details | text | | 詳細メモ（自由記述） |
| tags | string[] | | 任意タグ（v0.1ではデータ保持のみ。UIでは最小限または非表示） |
| createdAt | datetime | ✓ | 作成日時 |
| updatedAt | datetime | ✓ | 更新日時 |

- `id` は単一のプライマリキーとして使用
- `(user_id, themeId, date)` の組み合わせは一意（DB制約）
- 1日につき1テーマ1ログのみ作成可能
- ログが存在する日＝「学習した日」とみなす

---

### 2.3 MetaNote（メタノート）

| 項目 | 型 | 必須 | 説明 |
|---|---|---|---|
| id | string | ✓ | メタノートID |
| category | enum | ✓ | 気づき / 疑問 / 感情 |
| body | text | ✓ | 本文 |
| themeIds | string[] | | 関連テーマID（0..N） |
| relatedLogId | string | | 関連日次ログID（任意）。LearningLogEntry の単一 ID を参照する。 |
| noteDate | date | ✓ | 表示用日付（UI上は日本時間/JSTのローカル日付）。自由入力は不可。作成時にサーバー側で自動設定する（作成日のJST日付）。 |
| createdAt | datetime | ✓ | 作成日時 |
| updatedAt | datetime | ✓ | 更新日時 |

- `themeIds` 未設定の場合は「雑記」扱い
- `relatedLogId` は LearningLogEntry の単一 ID を指定（存在する場合）
- 日次ログ画面からメタノートを直接作成可能（relatedLogId は自動設定される）
- 学習ログが存在しない日でも作成可能

---

## 3. 画面仕様

### 3.1 テーマ管理画面
- テーマ一覧表示
- 新規作成 / 編集 / 達成フラグ切替
- 達成済みテーマの表示切替

---

### 3.2 ラーニングログ入力画面

- 日付選択
- テーマ選択（未達成テーマのみ表示。達成済みテーマを入力対象に含めるトグルは設けない）
- summary（必須）
- details（任意）
- tags（任意）

同一画面内に以下を表示：
- 当日のメタノート一覧（関連付け済み）
- 新規メタノート作成フォーム

---

### 3.3 ラーニングログ時系列ビュー

- 日付降順のタイムライン
- 表示内容：日付 / テーマ / summary
- フィルタ：
  - テーマ
  - 期間
  - 達成済みテーマ含む / 含まない

---

### 3.4 メタノート一覧画面

- 時系列表示（作成日 or ノート日付で切替可能）
- フィルタ：
  - カテゴリ（気づき / 疑問 / 感情）
  - テーマ（複数選択可）
  - 雑記のみ表示
- 並び順切替（昇順 / 降順）
- 並び替えキー切替：createdAt / updatedAt（noteDateは自由入力不可のため基本はcreatedAt相当として扱う）

---

### 3.5 Contribution 可視化画面

- GitHub Contribution 風カレンダー表示
- 対象：ラーニングログのみ
- 単位：日

#### 色付けルール

1. 表示期間内の日ごとの学習テーマ数を集計
2. 最大値 `maxCount` を算出
3. 濃淡レベルを以下で算出

```
// maxCount == 0（期間内ログ0件）の場合は全日 level=0
level = 0 if count == 0
level = ceil(count / maxCount * 9)  // 1〜9（少なくとも1件あれば色が付く）
```
- 0：未学習日
- 1〜9：学習量に応じた濃淡

---

## 4. 検索・フィルタ要件

### 4.1 ラーニングログ
- テーマ
- 期間
- 達成済みテーマの除外 / 含む

### 4.2 メタノート
- カテゴリ
- テーマ（複数指定）
- 期間
- 雑記（テーマ未設定）のみ

---

## 5. データ出力

- CSV形式でのエクスポートをサポート
- Theme / LearningLogEntry / MetaNote はそれぞれ独立して出力可能
- 日付・テーマID・本文はフラットなカラム構造を維持する
- 配列フィールドのCSV表現：`tags` / `themeIds` は 1カラムに `;` 区切りで格納する（例：`tag1;tag2`）

---

## 6. 制約・方針

- 個人利用前提
- 継続しやすさを最優先（入力コストを低く保つ）
- データ構造は将来拡張を妨げないことを重視
- Webベースでのマルチデバイス同期を前提とする

### 6.1 日付とタイムゾーン
- UIで扱う日付（`LearningLogEntry.date`, `MetaNote.noteDate`）は **日本時間（JST）のローカル日付** とする
- `createdAt` / `updatedAt` は **UTC** で保持してよい（監査・同期用途）

### 6.2 削除方針
- v0.1では **物理削除** を基本とする
- 技術スタック上、容易に実装できる場合は **論理削除**（例：`isDeleted`, `deletedAt`）を採用してもよい

### 6.3 既存ログの取り扱い
- `(themeId, date)` の LearningLogEntry が既に存在する場合、「新規作成」導線から遷移した際は **新規作成ではなく既存エントリを開いて編集** する

